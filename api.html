<!doctype html>
<html lang="en">
<head>
	<title>Sexcoin API Info page</title>
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<meta name="description" content="Sexcoin API for payments on your websites." />
	<meta name="keywords" content="Sexcoin API, API button,SXC, API" />
	<link rel="stylesheet" type="text/css" href="css/main.css" />
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
	<script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>
	<link rel="icon" type="image/x-icon" href="images/favicon.ico">
	<script src="js/sxcapi.js"></script>
	<!--[if (IE 7) | (IE 8)]>
		<script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
		<script>
			$(function(){
				$('img.gear').remove();
			});
		</script>
	<![endif]-->
	<link rel="shortcut icon" href="/favicon.png" />
</head>
<body>
<header id="header">
	<section>
		<a href="/"><img width="304" height="78" src="images/logo.png" /></a>
		<div id="social1">
		<!--
			<iframe allowtransparency="true" frameborder="0" scrolling="no" src="http://platform.twitter.com/widgets/tweet_button.1363148939.html#_=1365084676934&amp;count=horizontal&amp;id=twitter-widget-0&amp;lang=en&amp;original_referer=http%3A%2F%2Fcoinwidget.com%2F&amp;size=m&amp;text=coinwidget.com&amp;url=http%3A%2F%2Fcoinwidget.com%2F" class="twitter-share-button twitter-count-horizontal" style="width:90px; height: 20px;" title="Twitter Tweet Button" data-twttr-rendered="true"></iframe>
			<iframe src="http://www.facebook.com/plugins/like.php?href=http%3A%2F%2Fcoinwidget.com%2F&amp;layout=button_count&amp;show_faces=true&amp;width=450&amp;action=like&amp;font=arial&amp;colorscheme=light&amp;height=21" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:90px; height:21px;" allowtransparency="true"></iframe>
		-->
			<script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script>
			<g:plusone></g:plusone>
			
		</div>
	</section>
</header>
<section>
	<div id="social2"><br/></div>
	<article class="primary">
		<h1>Howto Setup and Receive Payments</h1>
		<p>Ok, let's get down to brass tacks. The reason that you would consider accepting Sexcoin is because you want to get paid for your product or service. 
		You want the system to take information about products, create a payment address and, you need to have some sort of inventory control. 
		That is what SexcoinAPI can do for you in 3 easy steps.<br /><br />
		
		1) Setup items for purchase by using an invoice number, barcode number or any other description you want.<br />
        2) Post the payment Sexcoin address that is generated by the API tool<br />
		3) Payments made to that address will be forwarded to your Sexcoin Master address.</p>
		
		<br/>
		
	</article>
	<br />
	<article id="version_note">
		<h1>Got your Merchant Address?</h1>
		<p>Get a FREE starter Merchant Address at <a href="https://sxcwallet.com" target="_blank">SXCWallet.com</a> 
		(Vendor & Merchant services from SXCWallet.com are coming online soon) or use any receiving SXC address you want.</p>
	</article>	
	<article>
		<img style="position:absolute;top:15px;left:20px;" src="images/icon_75_gear.png" />
		<div style="margin-left:90px;">
			<h1>Configuration</h1>
			<p>Here are a few terms you want to learn</p>
		</div>
		<br/><br/>
		<table cellspacing="0" cellpadding="0" border="0">
		<thead>
			<tr><th width="100">Option</th>
			<th width="120">Acceptable Values</th>
			<th class="col_desc">Description</th>
		</tr></thead>
		<tbody>
			<tr>
				<td><b>Address (Master)</b></td>
				<td>Sexcoin Address</td>
				<td class="col_desc">The Master receiving address where all transactions from payment addresses are forwarded to. This is your final payment bucket.</td>
			</tr>
			<tr>
				<td><b>Callback</b></td>
				<td>max 255 char</td>
				<td class="col_desc">This is a url which will get sent to the GET request. It should include identifying parameters, like invoice numbers and your secret Identifier</td>
			</tr>
			<tr>
				<td><b>Donation</b></td>
				<td>No Min</td>
				<td class="col_desc">An amount to forward as a donation to SexcoinAPI (Recommended: 1.000000) This is good karma people.</td>
			</tr>
			<tr>
				<td><b>invoice_id</b></td>
				<td>No Min</td>
				<td class="col_desc">The unique identifier for your product or service. Use this to track Sexcoin payments from the API.</td>
			</tr>
			<tr>
				<td><b>min_forward</b></td>
				<td>No Min</td>
				<td class="col_desc">An amount threshold to hold payments before they are forwarded to your address(Recommended: 1.0000000). Setting this can dramatically lower fees.</td>
			</tr>
			<tr>
				<td><b>Payment Address</b></td>
				<td>Sexcoin Address</td>
				<td class="col_desc">This is the Sexcoin address that will be generated when you input your address and the call back url with the secret identifier. Use this address to ask for a payment and the
				when a payment is sent to this address it will be forwarded to your address. You then lookup the invoice for the address and get the payment details.</td>
			</tr>
			<tr>
				<td><b>Secret</b></td>
				<td></td>
				<td class="col_desc">Identifier that is unique to you and your account. Don't share this, it insures that API calls are private an no one is looking up your sales records</td>
			</tr>			
			<tr>
				<td><b>Tx Fee</b></td>
				<td>default 1.00000000</td>
				<td class="col_desc">Assessed Network fee in Sexcoin</td>
			</tr>
			<tr>
				<td><b>verify_ssl</b></td>
				<td><em>false</em></td>
				<td class="col_desc"> Verify ssl certs during callback. Your application should support https:// (encrypted) urls. You don't want someone intercepting, guessing secrets, etc.</td>
			</tr>
		</tbody>
	</table>
	</article>
<br />
<article>
	<img style="position:absolute;top:15px;left:20px;" src="images/icon_75_settings.png" />
	<div style="margin-left:90px;">
		<h1>Using the API and URL Structure</h1>
			Using the Sexcoin API requires that you construct a specific URL that is submitted to SexcoinAPI.com. The API returns a new Sexcoin Address that you use to request 
			the payment. When a purchase is made to the Payment Address the system will receive and forward the payment to your Master Address. You can then poll the API for 
			transaction details.<br />
			<br />
			<ul>
				<li>If min_forward is set, then transactions will "build up" until one is large enough to go out. Otherwise every transaction will get forwarded (vin=vout)</li>
				<li>If you're planning on getting lots of small confirmations, raise the network fee, to avoid excessive fees because the transaction larger transaction amounts have lower overall fees</li>
				<li>If no fee is specified, then the current forwarding rate will be assumed and 1 SXC will be deducted from transactions to be paid to the network (not to us). 
					<small>Note: Yes, you can use fee=0 to specify zero fee. BUT, Your mileage may vary and your receipt time for the network to process your request may be long</small></li>
				<li>Your URL should include a "secret" parameter. See notes above for explaination</li>		
			</ul>
		<br />
		<br/>
	<div class="example" style="">
		<h4>PHP Example:</h4>
		<pre>
		$secret = 'Your_secret_here'
		$my_address = 'Put your Master Address Here';
		$my_callback_url = 'https://site-url.com?invoice_id=696969&amp;secret='.$secret;
		$root_url = 'https://sexcoinapi.com/process/receive';
		$parameters = 'method=create&amp;address=' . $my_address .'&amp;callback='.
			urlencode($my_callback_url) . '&amp;fee=.001&amp;donation=.0005';
		$response = file_get_contents($root_url . '?' . $parameters);
		$object = json_decode($response);
		echo 'Send Payment To : ' . $object-&gt;input_address;	
		</pre>
	</div>
	<br />
	<div class="code" style="">
		<h4>Example Response: (JSON)</h4>
		<pre>
		{
		"callback_url" : "https://site-url.com/test.cgi",
		"destination" : "Your Master Address",
		"donation" : 0,
		"fee" : 0.001,
		"input_address" : "API Generated Payment Address",
		"verify_ssl" : 0
		}
		</pre>
	</div>	
	<br />
	<h4>Test Your Code:</h4>
	<br />
	<div class="example" style="margin-left: 190px;">
			<form class="cleft" action="https://sexcoinapi.com/process/receive">
			<input name=method value=create type=hidden />
				<label for="address">Address</label> <input name=address /><br />
				<br />
				<label for="callback">Callback</label> <input name=callback /><br />
				<br />
				<button type="submit" value="Generate" style="box-shadow:inset 1px 1px 0px #76b5f2;padding:8px;margin-left:30px;"/>Generate API Link</button>
			</form>
	</div>
	</div>
</article>
	<br />
<article>
	<img style="position:absolute;top:15px;left:20px;" src="images/icon_75_settings.png" />
	<div style="margin-left:90px;">
		<h1>Receive Callbacks</h1>
			When a payment is received the SexcoinAPI forwards the payment it to the payment address, unless min_forward is set.<br />
			The callback url is used to send an http GET request to query for the payment details (JSON). 
		<br />
		<br />
		<h4>Parameters</h4>
			<ul>
			<li>value - The value of the payment received in SXC*100000000. Divide by 100000000 to get the value in SXC.
			<li>value_sxc - The value of the payment received in SXC.
			<li>input_address - The Sexcoin address that received the transaction.
			<li>confirmations - The number of confirmations of this transaction.
			<li>{Custom Parameters} - Any parameters included in the callback URL will be passed back to the callback URL in the notification.
			<li>transaction_hash - The transaction hash id (you can paste this is to sxcblockexplorer.com to view it).
			<li>destination_address - The payment Sexcoin address. Check that this matches your address, or you will be paying someone else!
		</ul>
		<br />
	<div class="code" style="">
		<h4>PHP Example:</h4>
		<pre>
		$real_secret = 'Your_Secret_here'
		$invoice_id = $_GET['invoice_id']; //invoice_id is past back to the callback URL
		$transaction_hash = $_GET['transaction_hash'];
		$input_address = $_GET['input_address'];
		$value_in_sxc = $_GET['value_sxc'];
		//Commented out to test, uncomment when live
			if ($_GET['test'] == true) {
				return;
			}
			try {
				 $database = new SQLiteDatabase('db.sqlite', 0666, $error);
			} catch(Exception $e) {
				die($error);
			}
		//Add the invoice to the database
		$query = "insert INTO invoice_payments (invoice_id, transaction_hash, value)
			values($invoice_id, '$transaction_hash', $value_in_sxc)";
		if($database->queryExec($query, $error)) {
			echo "*ok*";
		}
		//Select the amount paid into an invoice with select SUM(value) as value
			from invoice_payments where invoice_id = $invoice_id
		</pre>
	</div>
	</div>
</article>
	<br />
<article>
	<img style="position:absolute;top:15px;left:20px;" src="images/icon_75_settings.png" />
	<div style="margin-left:90px;">
		<h1>Polling the API</h1>
			If you want to POLL for results, use a poll: URL (any valid url that begins with poll: will do).<br /> 
			You will not receive any callbacks, but you can always poll for transactions. So, it is possible to query for a transaction list, review the amount sent, and
			run these totals into your inventory managment system.  In this way, it's possible to build a payment system based on the Sexcoin API.<br />
		<br />
	<div class="code" style="">
		<h4>PHP Example:</h4>
		<pre>
		$secret = 'Your_secret_here'
		$my_address = 'Put your Master Address Here';
		$my_callback_url = 'https://site-url.com?invoice_id=696969&amp;secret='.$secret;
		$root_url = 'https://sexcoinapi.com/process/poll';
		$parameters = 'callback='. urlencode($my_callback_url) . '&amp;confirm=6';
		$response = file_get_contents($root_url . '?' . $parameters);
		$object = json_decode($response);
		echo 'Pymt Rollup : ' . $object-&gt;amount;
		</pre>
	</div>
	<br />
	<div class="code" style="">
		<h4>Example Response: (JSON)</h4>
		<pre>
		{
		"amount" : 0.59,
		"count" : 1,
		"time" : 1389451756,
			"txs" : [
			{
			"amount" : 0.59,
			"conf" : 928,
			"dest" : "Your Master Address shows here",
			"input" : "Payment Address Used shows here",
			"time" : 1389451656,
			"txid" : "TXID you can use with blockexplorer to trace the payment"
			}
			]
		}
		</pre>
	</div>	
	<br />
	<h4>Test your Code</h4>
	<br />
	<div class="code" style="margin-left: 190px;">
		<form class="cleft" action="https://sexcoinapi.com/process/poll">
			<label for="callback">Callback</label> <input name=callback /><br />
			<br />
			<button type="submit" value="Poll"style="box-shadow:inset 1px 1px 0px #76b5f2;padding:8px;margin-left:20px;"/>Generate Polling Detail</button>
		</form>
	</div>
	</div>
</article>
	<br />	
<article>
	<div class="social2">
	<h3>Security</h3>
	Every callback URL should contain the secret key known only to the API user.  You should also be using an SSL callback URL so that  
	no one can forge a callback on your account. Alternatively, you can poll for the results by using a callback URL beginning with `poll:`
	</div>
</article>	
	<br />
	<small id="footer">&copy; 2014 SexcoinAPI.com</small>
</section>
</body>
</html>
